const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AddCommentForm-OETmRWSr.js","assets/index-B5sKGF0T.js","assets/index-wA14FdWZ.css","assets/DynamicModuleLoader-CRhxfWmK.js","assets/Input-C1-90urI.js","assets/Text-SEN0pMjy.js","assets/Text-BF0WDxCW.css","assets/Input-FNQXRdNZ.css","assets/Avatar-CS1FaJc3.js","assets/Avatar-DN3jM9jA.css","assets/AddCommentForm-CYqtewZH.css","assets/ArticleRating-832tZ5hT.js","assets/Drawer-VE2znHAb.js","assets/Drawer-BLc3hEGI.css","assets/StickyContentLayout-Bajp4WFw.js","assets/StickyContentLayout-BirhuSL-.css","assets/ArticleRating-0qhFcG3T.css"])))=>i.map(i=>d[i]);
import{q as I,r as n,u as h,j as t,V as d,e as m,_ as y,S as E,t as k,v as b,H as S,c as L,a as R,l as P,g as z,b as _,d as V,h as $,L as T,w as W,i as N,f as q,x as B,y as F,P as H}from"./index-B5sKGF0T.js";import{D as O}from"./DynamicModuleLoader-CRhxfWmK.js";import{c as U,g as v,d as G,e as M,S as Q}from"./StickyContentLayout-Bajp4WFw.js";import{T as l}from"./Text-SEN0pMjy.js";import{C as D,A as w}from"./Avatar-CS1FaJc3.js";const J=I.injectEndpoints({endpoints:a=>({getArticleRecommendationsList:a.query({query:e=>({url:"/articles",params:{_limit:e,_expand:"user"}})})})}),K=J.useGetArticleRecommendationsListQuery,X=n.memo(a=>{const{className:e}=a,{t:s}=h(),{isLoading:r,data:i,error:c}=K(3);return r||c||!i?null:t.jsxs(d,{"data-testid":"ArticleRecommendationsList",gap:"8",className:m("",{},[e]),children:[t.jsx(l,{size:"l",title:s("Рекомендуем")}),t.jsx(U,{articles:i,target:"_blank"})]})}),Y=n.lazy(()=>y(()=>import("./AddCommentForm-OETmRWSr.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),Z="_CommentCard_1adf2_1",ee="_header_1adf2_6",te="_username_1adf2_11",ae="_loading_1adf2_15",u={CommentCard:Z,header:ee,username:te,loading:ae},j=n.memo(a=>{const{className:e,comment:s,isLoading:r}=a,i=E;return r?t.jsxs(d,{"data-testid":"CommentCard.Loading",gap:"8",max:!0,className:m(u.CommentCard,{},[e,u.loading]),children:[t.jsxs("div",{className:u.header,children:[t.jsx(i,{width:30,height:30,border:"50%"}),t.jsx(i,{height:16,width:100,className:u.username})]}),t.jsx(i,{className:u.text,width:"100%",height:50})]}):s?t.jsx(D,{padding:"24",border:"partial",fullWidth:!0,children:t.jsxs(d,{"data-testid":"CommentCard.Content",gap:"8",max:!0,className:m(u.CommentCardRedesigned,{},[e]),children:[t.jsx(k,{to:b(s.user.id),children:t.jsxs(S,{gap:"8",children:[s.user.avatar?t.jsx(w,{size:30,src:s.user.avatar}):null,t.jsx(l,{text:s.user.username,bold:!0})]})}),t.jsx(l,{text:s.text})]})}):null}),se=n.memo(a=>{const{className:e,isLoading:s,comments:r}=a,{t:i}=h();return s?t.jsxs(d,{gap:"16",max:!0,className:m("",{},[e]),children:[t.jsx(j,{isLoading:!0}),t.jsx(j,{isLoading:!0}),t.jsx(j,{isLoading:!0})]}):t.jsx(d,{gap:"16",max:!0,className:m("",{},[e]),children:r!=null&&r.length?r.map(c=>t.jsx(j,{isLoading:s,comment:c},c.id)):t.jsx(l,{text:i("Комментарии отсутствуют")})})}),p=L("articleDetails/fetchCommentsByArticleId",async(a,e)=>{const{extra:s,rejectWithValue:r}=e;if(!a)return r("error");try{const i=await s.api.get("/comments",{params:{articleId:a,_expand:"user"}});if(!i.data)throw new Error;return i.data}catch{return r("error")}}),A=P({selectId:a=>a.id}),re=A.getSelectors(a=>{var e;return((e=a.articleDetailsPage)==null?void 0:e.comments)||A.getInitialState()}),ie=R({name:"articleDetailsCommentsSlice",initialState:A.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:a=>{a.addCase(p.pending,e=>{e.error=void 0,e.isLoading=!0}).addCase(p.fulfilled,(e,s)=>{e.isLoading=!1,A.setAll(e,s.payload)}).addCase(p.rejected,(e,s)=>{e.isLoading=!1,e.error=s.payload})}}),{reducer:ne}=ie,ce=a=>{var e,s;return(s=(e=a.articleDetailsPage)==null?void 0:e.comments)==null?void 0:s.isLoading},oe=L("articleDetails/addCommentForArticle",async(a,e)=>{const{extra:s,dispatch:r,rejectWithValue:i,getState:c}=e,o=z(c()),g=v(c());if(!o||!a||!g)return i("no data");try{const x=await s.api.post("/comments",{articleId:g.id,userId:o.id,text:a});if(!x.data)throw new Error;return r(p(g.id)),x.data}catch{return i("error")}}),le=n.memo(a=>{const{className:e,id:s}=a,{t:r}=h(),i=_(re.selectAll),c=_(ce),o=V(),g=n.useCallback(x=>{o(oe(x))},[o]);return $(()=>{o(p(s))}),t.jsxs(d,{gap:"16",max:!0,className:m("",{},[e]),children:[t.jsx(l,{size:"l",title:r("Комментарии")}),t.jsx(n.Suspense,{fallback:t.jsx(T,{}),children:t.jsx(Y,{onSendComment:g})}),t.jsx(se,{isLoading:c,comments:i})]})}),de="_ArticleDetailsPage_1eti8_1",me={ArticleDetailsPage:de},C=L("articleDetailsPage/fetchArticleRecommendations",async(a,e)=>{const{extra:s,rejectWithValue:r}=e;try{const i=await s.api.get("/articles",{params:{_limit:4}});if(!i.data)throw new Error;return i.data}catch{return r("error")}}),f=P({selectId:a=>a.id});f.getSelectors(a=>{var e;return((e=a.articleDetailsPage)==null?void 0:e.recommendations)||f.getInitialState()});const ue=R({name:"articleDetailsPageRecommendationsSlice",initialState:f.getInitialState({isLoading:!1,error:void 0,ids:[],entities:{}}),reducers:{},extraReducers:a=>{a.addCase(C.pending,e=>{e.error=void 0,e.isLoading=!0}).addCase(C.fulfilled,(e,s)=>{e.isLoading=!1,f.setAll(e,s.payload)}).addCase(C.rejected,(e,s)=>{e.isLoading=!1,e.error=s.payload})}}),{reducer:ge}=ue,xe=W({recommendations:ge,comments:ne}),pe=n.lazy(()=>y(()=>import("./ArticleRating-832tZ5hT.js"),__vite__mapDeps([11,1,2,12,13,5,6,4,7,8,9,14,3,15,16]))),he=a=>t.jsx(n.Suspense,{fallback:t.jsx(G,{width:"100%",height:140}),children:t.jsx(pe,{...a})}),je=n.memo(a=>{const{className:e}=a,{id:s}=N();return t.jsx(D,{fullWidth:!0,border:"partial",className:e,padding:"24",children:t.jsx(M,{id:s})})}),Ae=n.memo(a=>{const{className:e,author:s,createdAt:r,views:i,onEdit:c}=a,{t:o}=h();return t.jsxs(d,{gap:"32",className:e,children:[t.jsxs(S,{gap:"8",children:[t.jsx(w,{src:s.avatar,size:32}),t.jsx(l,{text:s.username,bold:!0}),t.jsx(l,{text:r})]}),t.jsx(q,{onClick:c,children:o("Редактировать")}),t.jsx(l,{text:o("{{count}} просмотров",{count:i})})]})}),fe="_card_omi3g_1",Ce={card:fe},_e=n.memo(()=>{const a=_(v),e=B(),s=n.useCallback(()=>{a&&e(F(a.id))},[a,e]);return a?t.jsx(D,{padding:"24",border:"partial",className:Ce.card,children:t.jsx(Ae,{onEdit:s,author:a.user,createdAt:a.createdAt,views:a.views})}):null}),Le={articleDetailsPage:xe},De=a=>{const{className:e}=a,{t:s}=h("article-details"),{id:r}=N();return r?t.jsx(O,{reducers:Le,removeAfterUnmount:!0,children:t.jsx(Q,{content:t.jsx(H,{className:m(me.ArticleDetailsPage,{},[e]),children:t.jsxs(d,{gap:"16",max:!0,children:[t.jsx(je,{}),t.jsx(he,{articleId:r}),t.jsx(X,{}),t.jsx(le,{id:r})]})}),right:t.jsx(_e,{})})}):null},ve=n.memo(De);export{ve as default};
