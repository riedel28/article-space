var qt=s=>{throw TypeError(s)};var Ht=(s,i,t)=>i.has(s)||qt("Cannot "+t);var m=(s,i,t)=>(Ht(s,i,"read from private field"),t?t.call(s):i.get(s)),E=(s,i,t)=>i.has(s)?qt("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(s):i.set(s,t),w=(s,i,t,r)=>(Ht(s,i,"write to private field"),r?r.call(s,t):i.set(s,t),t);var Xt=(s,i,t,r)=>({set _(e){w(s,i,e,t)},get _(){return m(s,i,r)}});import{a2 as fe,a3 as me,r as P,j as V,c as ge,a4 as ve,a as pe,a5 as ht,u as ye,d as Me,b as ft,C as be,a6 as Jt,a7 as Se}from"./index-B5sKGF0T.js";import{D as Ve}from"./DynamicModuleLoader-CRhxfWmK.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fe=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],we=fe("loader-circle",Fe),tt=new WeakMap,bt=new WeakMap,wt={current:[]};let kt=!1,lt=0;const at=new Set,mt=new Map;function ne(s){const i=Array.from(s).sort((t,r)=>t instanceof N&&t.options.deps.includes(r)?1:r instanceof N&&r.options.deps.includes(t)?-1:0);for(const t of i){if(wt.current.includes(t))continue;wt.current.push(t),t.recompute();const r=bt.get(t);if(r)for(const e of r){const n=tt.get(e);n&&ne(n)}}}function Ee(s){const i={prevVal:s.prevState,currentVal:s.state};for(const t of s.listeners)t(i)}function Le(s){const i={prevVal:s.prevState,currentVal:s.state};for(const t of s.listeners)t(i)}function ae(s){if(lt>0&&!mt.has(s)&&mt.set(s,s.prevState),at.add(s),!(lt>0)&&!kt)try{for(kt=!0;at.size>0;){const i=Array.from(at);at.clear();for(const t of i){const r=mt.get(t)??t.prevState;t.prevState=r,Ee(t)}for(const t of i){const r=tt.get(t);r&&(wt.current.push(t),ne(r))}for(const t of i){const r=tt.get(t);if(r)for(const e of r)Le(e)}}}finally{kt=!1,wt.current=[],mt.clear()}}function $(s){lt++;try{s()}finally{if(lt--,lt===0){const i=at.values().next().value;i&&ae(i)}}}function Ae(s){return typeof s=="function"}class Et{constructor(i,t){this.listeners=new Set,this.subscribe=r=>{var e,n;this.listeners.add(r);const a=(n=(e=this.options)==null?void 0:e.onSubscribe)==null?void 0:n.call(e,r,this);return()=>{this.listeners.delete(r),a==null||a()}},this.prevState=i,this.state=i,this.options=t}setState(i){var t,r,e;this.prevState=this.state,(t=this.options)!=null&&t.updateFn?this.state=this.options.updateFn(this.prevState)(i):Ae(i)?this.state=i(this.prevState):this.state=i,(e=(r=this.options)==null?void 0:r.onUpdate)==null||e.call(r),ae(this)}}class N{constructor(i){this.listeners=new Set,this._subscriptions=[],this.lastSeenDepValues=[],this.getDepVals=()=>{const t=this.options.deps.length,r=new Array(t),e=new Array(t);for(let n=0;n<t;n++){const a=this.options.deps[n];r[n]=a.prevState,e[n]=a.state}return this.lastSeenDepValues=e,{prevDepVals:r,currDepVals:e,prevVal:this.prevState??void 0}},this.recompute=()=>{var t,r;this.prevState=this.state;const e=this.getDepVals();this.state=this.options.fn(e),(r=(t=this.options).onUpdate)==null||r.call(t)},this.checkIfRecalculationNeededDeeply=()=>{for(const n of this.options.deps)n instanceof N&&n.checkIfRecalculationNeededDeeply();let t=!1;const r=this.lastSeenDepValues,{currDepVals:e}=this.getDepVals();for(let n=0;n<e.length;n++)if(e[n]!==r[n]){t=!0;break}t&&this.recompute()},this.mount=()=>(this.registerOnGraph(),this.checkIfRecalculationNeededDeeply(),()=>{this.unregisterFromGraph();for(const t of this._subscriptions)t()}),this.subscribe=t=>{var r,e;this.listeners.add(t);const n=(e=(r=this.options).onSubscribe)==null?void 0:e.call(r,t,this);return()=>{this.listeners.delete(t),n==null||n()}},this.options=i,this.state=i.fn({prevDepVals:void 0,prevVal:void 0,currDepVals:this.getDepVals().currDepVals})}registerOnGraph(i=this.options.deps){for(const t of i)if(t instanceof N)t.registerOnGraph(),this.registerOnGraph(t.options.deps);else if(t instanceof Et){let r=tt.get(t);r||(r=new Set,tt.set(t,r)),r.add(this);let e=bt.get(this);e||(e=new Set,bt.set(this,e)),e.add(t)}}unregisterFromGraph(i=this.options.deps){for(const t of i)if(t instanceof N)this.unregisterFromGraph(t.options.deps);else if(t instanceof Et){const r=tt.get(t);r&&r.delete(this);const e=bt.get(this);e&&e.delete(t)}}}function Ie(s){return typeof s=="function"}function Qt(s,...i){return Ie(s)?s(...i):s}function Te(s){return s||(typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():"")}var j,C,D,ut,W,q,R,st,ct,It,z,dt,it,Tt;class oe{constructor({pluginId:i,debug:t=!1,enabled:r=!0,reconnectEveryMs:e=300}){E(this,j,!0);E(this,C);E(this,D);E(this,ut);E(this,W);E(this,q);E(this,R);E(this,st);E(this,ct,0);E(this,It,5);E(this,z,!1);E(this,dt,()=>{this.debugLog("Connected to event bus"),w(this,q,!0),w(this,z,!1),this.debugLog("Emitting queued events",m(this,W)),m(this,W).forEach(i=>this.emitEventToBus(i)),w(this,W,[]),this.stopConnectLoop(),m(this,D).call(this).removeEventListener("tanstack-connect-success",m(this,dt))});E(this,it,()=>{if(m(this,ct)<m(this,It)){Xt(this,ct)._++,this.dispatchCustomEvent("tanstack-connect",{});return}m(this,D).call(this).removeEventListener("tanstack-connect",m(this,it)),this.debugLog("Max retries reached, giving up on connection"),this.stopConnectLoop()});E(this,Tt,()=>{m(this,z)||(w(this,z,!0),m(this,D).call(this).addEventListener("tanstack-connect-success",m(this,dt)),m(this,it).call(this))});w(this,C,i),w(this,j,r),w(this,D,this.getGlobalTarget),w(this,ut,t),this.debugLog(" Initializing event subscription for plugin",m(this,C)),w(this,W,[]),w(this,q,!1),w(this,R,null),w(this,st,e)}startConnectLoop(){m(this,R)!==null||m(this,q)||(this.debugLog(`Starting connect loop (every ${m(this,st)}ms)`),w(this,R,setInterval(m(this,it),m(this,st))))}stopConnectLoop(){w(this,z,!1),m(this,R)!==null&&(clearInterval(m(this,R)),w(this,R,null),this.debugLog("Stopped connect loop"))}debugLog(...i){m(this,ut)&&console.log(`ðŸŒ´ [tanstack-devtools:${m(this,C)}-plugin]`,...i)}getGlobalTarget(){if(typeof globalThis<"u"&&globalThis.__TANSTACK_EVENT_TARGET__)return this.debugLog("Using global event target"),globalThis.__TANSTACK_EVENT_TARGET__;if(typeof window<"u"&&typeof window.addEventListener<"u")return this.debugLog("Using window as event target"),window;const i=typeof EventTarget<"u"?new EventTarget:void 0;return typeof i>"u"||typeof i.addEventListener>"u"?(this.debugLog("No event mechanism available, running in non-web environment"),{addEventListener:()=>{},removeEventListener:()=>{},dispatchEvent:()=>!1}):(this.debugLog("Using new EventTarget as fallback"),i)}getPluginId(){return m(this,C)}dispatchCustomEventShim(i,t){try{const r=new Event(i,{detail:t});m(this,D).call(this).dispatchEvent(r)}catch{this.debugLog("Failed to dispatch shim event")}}dispatchCustomEvent(i,t){try{m(this,D).call(this).dispatchEvent(new CustomEvent(i,{detail:t}))}catch{this.dispatchCustomEventShim(i,t)}}emitEventToBus(i){this.debugLog("Emitting event to client bus",i),this.dispatchCustomEvent("tanstack-dispatch-event",i)}emit(i,t){if(!m(this,j)){this.debugLog("Event bus client is disabled, not emitting event",i,t);return}if(!m(this,q)){this.debugLog("Bus not available, will be pushed as soon as connected"),m(this,W).push({type:`${m(this,C)}:${i}`,payload:t,pluginId:m(this,C)}),typeof CustomEvent<"u"&&!m(this,z)&&(m(this,Tt).call(this),this.startConnectLoop());return}return this.emitEventToBus({type:`${m(this,C)}:${i}`,payload:t,pluginId:m(this,C)})}on(i,t){const r=`${m(this,C)}:${i}`;if(!m(this,j))return this.debugLog("Event bus client is disabled, not registering event",r),()=>{};const e=n=>{this.debugLog("Received event from bus",n.detail),t(n.detail)};return m(this,D).call(this).addEventListener(r,e),this.debugLog("Registered event to bus",r),()=>{m(this,D).call(this).removeEventListener(r,e)}}onAll(i){if(!m(this,j))return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const t=r=>{const e=r.detail;i(e)};return m(this,D).call(this).addEventListener("tanstack-devtools-global",t),()=>m(this,D).call(this).removeEventListener("tanstack-devtools-global",t)}onAllPluginEvents(i){if(!m(this,j))return this.debugLog("Event bus client is disabled, not registering event"),()=>{};const t=r=>{const e=r.detail;m(this,C)&&e.pluginId!==m(this,C)||i(e)};return m(this,D).call(this).addEventListener("tanstack-devtools-global",t),()=>m(this,D).call(this).removeEventListener("tanstack-devtools-global",t)}}j=new WeakMap,C=new WeakMap,D=new WeakMap,ut=new WeakMap,W=new WeakMap,q=new WeakMap,R=new WeakMap,st=new WeakMap,ct=new WeakMap,It=new WeakMap,z=new WeakMap,dt=new WeakMap,it=new WeakMap,Tt=new WeakMap;class De extends oe{constructor(i){super({pluginId:"pacer",debug:i==null?void 0:i.debug})}}const Ce=(s,i)=>{le.emit(s,i)},le=new De;function Yt(){return{executionCount:0,isPending:!1,lastArgs:void 0,lastExecutionTime:0,nextExecutionTime:0,status:"idle",maybeExecuteCount:0}}const _e={enabled:!0,leading:!0,trailing:!0,wait:0};var K,O,H,X,J,rt;class ke{constructor(i,t){E(this,K);E(this,O);E(this,H);E(this,X);E(this,J);E(this,rt);this.fn=i,this.store=new Et(Yt()),this.setOptions=r=>{this.options={...this.options,...r},m(this,H).call(this)||this.cancel()},w(this,O,r=>{this.store.setState(e=>{const n={...e,...r},{isPending:a}=n;return{...n,status:m(this,H).call(this)?a?"pending":"idle":"disabled"}}),Ce("Throttler",this)}),w(this,H,()=>!!Qt(this.options.enabled,this)),w(this,X,()=>Qt(this.options.wait,this)),this.maybeExecute=(...r)=>{m(this,O).call(this,{maybeExecuteCount:this.store.state.maybeExecuteCount+1});const e=Date.now(),n=e-this.store.state.lastExecutionTime,a=m(this,X).call(this);if(this.options.leading&&n>=a)m(this,J).call(this,...r);else if(m(this,O).call(this,{lastArgs:r}),!m(this,K)&&this.options.trailing){const o=this.store.state.lastExecutionTime?e-this.store.state.lastExecutionTime:0,d=a-o;m(this,O).call(this,{isPending:!0}),w(this,K,setTimeout(()=>{const{lastArgs:u}=this.store.state;u!==void 0&&m(this,J).call(this,...u)},d))}},w(this,J,(...r)=>{var a,o;if(!m(this,H).call(this))return;this.fn(...r);const e=Date.now(),n=e+m(this,X).call(this);m(this,rt).call(this),m(this,O).call(this,{executionCount:this.store.state.executionCount+1,lastExecutionTime:e,nextExecutionTime:n,isPending:!1,lastArgs:void 0}),(o=(a=this.options).onExecute)==null||o.call(a,r,this),setTimeout(()=>{this.store.state.isPending||m(this,O).call(this,{nextExecutionTime:void 0})},m(this,X).call(this))}),this.flush=()=>{this.store.state.isPending&&this.store.state.lastArgs&&m(this,J).call(this,...this.store.state.lastArgs)},w(this,rt,()=>{m(this,K)&&(clearTimeout(m(this,K)),w(this,K,void 0))}),this.cancel=()=>{m(this,rt).call(this),m(this,O).call(this,{lastArgs:void 0,isPending:!1})},this.reset=()=>{m(this,O).call(this,Yt())},this.key=Te(t.key),this.options={..._e,...t},m(this,O).call(this,this.options.initialState??{}),le.on("d-Throttler",r=>{r.payload.key===this.key&&(m(this,O).call(this,r.payload.store.state),this.setOptions(r.payload.options))})}}K=new WeakMap,O=new WeakMap,H=new WeakMap,X=new WeakMap,J=new WeakMap,rt=new WeakMap;function Oe(s,i){return new ke(s,i).maybeExecute}function Dt(s,i){return typeof s=="function"?s(i):s}function ot(s,i){return jt(i).reduce((r,e)=>{if(r===null)return null;if(typeof r<"u")return r[e]},s)}function gt(s,i,t){const r=jt(i);function e(n){if(!r.length)return Dt(t,n);const a=r.shift();if(typeof a=="string"||typeof a=="number"&&!Array.isArray(n))return typeof n=="object"?(n===null&&(n={}),{...n,[a]:e(n[a])}):{[a]:e()};if(Array.isArray(n)&&typeof a=="number"){const o=n.slice(0,a);return[...o.length?o:new Array(a),e(n[a]),...n.slice(a+1)]}return[...new Array(a),e()]}return e(s)}function xe(s,i){const t=jt(i);function r(e){if(!e)return;if(t.length===1){const a=t[0];if(Array.isArray(e)&&typeof a=="number")return e.filter((u,l)=>l!==a);const{[a]:o,...d}=e;return d}const n=t.shift();if(typeof n=="string"&&typeof e=="object")return{...e,[n]:r(e[n])};if(typeof n=="number"&&Array.isArray(e)){if(n>=e.length)return e;const a=e.slice(0,n);return[...a.length?a:new Array(n),r(e[n]),...e.slice(n+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return r(s)}const Pe=/^(\d+)$/gm,Be=/\.(\d+)(?=\.)/gm,$e=/^(\d+)\./gm,Re=/\.(\d+$)/gm,Ne=/\.{2,}/gm,xt="__int__",vt=`${xt}$1`;function jt(s){if(Array.isArray(s))return[...s];if(typeof s!="string")throw new Error("Path must be a string.");return s.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(Pe,vt).replace(Be,`.${vt}.`).replace($e,`${vt}.`).replace(Re,`.${vt}`).replace(Ne,".").split(".").map(i=>{if(i.startsWith(xt)){const t=i.substring(xt.length),r=parseInt(t,10);return String(r)===t?r:t}return i})}function Ue(s){return!(Array.isArray(s)&&s.length===0)}function Pt(s,i){const t=r=>r.validators.filter(Boolean).map(e=>({cause:e.cause,validate:e.fn}));return i.validationLogic({form:i.form,validators:i.validators,event:{type:s,async:!1},runValidation:t})}function Bt(s,i){const{asyncDebounceMs:t}=i,{onBlurAsyncDebounceMs:r,onChangeAsyncDebounceMs:e,onDynamicAsyncDebounceMs:n}=i.validators||{},a=t??0,o=d=>d.validators.filter(Boolean).map(u=>{const l=(u==null?void 0:u.cause)||s;let c=a;switch(l){case"change":c=e??a;break;case"blur":c=r??a;break;case"dynamic":c=n??a;break;case"submit":c=0;break}return s==="submit"&&(c=0),{cause:l,validate:u.fn,debounceMs:c}});return i.validationLogic({form:i.form,validators:i.validators,event:{type:s,async:!0},runValidation:o})}const $t=s=>!!s&&typeof s=="object"&&"fields"in s;function Y(s,i){if(Object.is(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;if(s instanceof Date&&i instanceof Date)return s.getTime()===i.getTime();if(s instanceof Map&&i instanceof Map){if(s.size!==i.size)return!1;for(const[e,n]of s)if(!i.has(e)||!Object.is(n,i.get(e)))return!1;return!0}if(s instanceof Set&&i instanceof Set){if(s.size!==i.size)return!1;for(const e of s)if(!i.has(e))return!1;return!0}const t=Object.keys(s),r=Object.keys(i);if(t.length!==r.length)return!1;for(const e of t)if(!r.includes(e)||!Y(s[e],i[e]))return!1;return!0}const Zt=({newFormValidatorError:s,isPreviousErrorFromFormValidator:i,previousErrorValue:t})=>s?{newErrorValue:s,newSource:"form"}:i?{newErrorValue:void 0,newSource:void 0}:t?{newErrorValue:t,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},te=({formLevelError:s,fieldLevelError:i})=>i?{newErrorValue:i,newSource:"field"}:s?{newErrorValue:s,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function _(s,i){return s==null?i:{...s,...i}}let G=256;const St=[];let pt;for(;G--;)St[G]=(G+256).toString(16).substring(1);function je(){let s=0,i,t="";if(!pt||G+16>256){for(pt=new Array(256),s=256;s--;)pt[s]=256*Math.random()|0;s=0,G=0}for(;s<16;s++)i=pt[G+s],s===6?t+=St[i&15|64]:s===8?t+=St[i&63|128]:t+=St[i],s&1&&s>1&&s<11&&(t+="-");return G++,t}const Z=s=>{if(!s.validators)return s.runValidation({validators:[],form:s.form});const i=s.event.async,t=i?void 0:{fn:s.validators.onMount,cause:"mount"},r={fn:i?s.validators.onChangeAsync:s.validators.onChange,cause:"change"},e={fn:i?s.validators.onBlurAsync:s.validators.onBlur,cause:"blur"},n={fn:i?s.validators.onSubmitAsync:s.validators.onSubmit,cause:"submit"},a=i?void 0:{fn:()=>{},cause:"server"};switch(s.event.type){case"mount":return s.runValidation({validators:[t],form:s.form});case"submit":return s.runValidation({validators:[r,e,n,a],form:s.form});case"server":return s.runValidation({validators:[],form:s.form});case"blur":return s.runValidation({validators:[e,a],form:s.form});case"change":return s.runValidation({validators:[r,a],form:s.form});default:throw new Error(`Unknown validation event type: ${s.event.type}`)}};function We(s,i){const t=new Map;for(const r of s){const e=r.path??[];let n=i,a="";for(let o=0;o<e.length;o++){const d=e[o];if(d===void 0)continue;const u=typeof d=="object"?d.key:d,l=Number(u);Array.isArray(n)&&!Number.isNaN(l)?a+=`[${l}]`:a+=(o>0?".":"")+String(u),typeof n=="object"&&n!==null?n=n[u]:n=void 0}t.set(a,(t.get(a)??[]).concat(r))}return Object.fromEntries(t)}const ee=(s,i)=>{const t=We(s,i);return{form:t,fields:t}},et={validate({value:s,validationSource:i},t){const r=t["~standard"].validate(s);if(r instanceof Promise)throw new Error("async function passed to sync validator");if(r.issues)return i==="field"?r.issues:ee(r.issues,s)},async validateAsync({value:s,validationSource:i},t){const r=await t["~standard"].validate(s);if(r.issues)return i==="field"?r.issues:ee(r.issues,s)}},ue=s=>!!s&&"~standard"in s,Lt={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function yt(s){function i(c,f,h,g){const v=r(c,f,h,g);({insert:()=>o(v,c,f),remove:()=>d(v),swap:()=>g!==void 0&&l(v,c,f,g),move:()=>g!==void 0&&u(v,c,f,g)})[h]()}function t(c,f){return`${c}[${f}]`}function r(c,f,h,g){const v=[t(c,f)];if(h==="swap")v.push(t(c,g));else if(h==="move"){const[p,M]=[Math.min(f,g),Math.max(f,g)];for(let y=p;y<=M;y++)v.push(t(c,y))}else{const p=s.getFieldValue(c),M=Array.isArray(p)?p.length:0;for(let y=f+1;y<M;y++)v.push(t(c,y))}return Object.keys(s.fieldInfo).filter(p=>v.some(M=>p.startsWith(M)))}function e(c,f){return c.replace(/\[(\d+)\]/,(h,g)=>{const v=parseInt(g,10);return`[${f==="up"?v+1:Math.max(0,v-1)}]`})}function n(c,f){(f==="up"?c:[...c].reverse()).forEach(g=>{const v=e(g.toString(),f),p=s.getFieldMeta(v);p?s.setFieldMeta(g,p):s.setFieldMeta(g,a())})}const a=()=>Lt,o=(c,f,h)=>{n(c,"down"),c.forEach(g=>{g.toString().startsWith(t(f,h))&&s.setFieldMeta(g,a())})},d=c=>{n(c,"up")},u=(c,f,h,g)=>{const v=new Map(Object.keys(s.fieldInfo).filter(p=>p.startsWith(t(f,h))).map(p=>[p,s.getFieldMeta(p)]));n(c,h<g?"up":"down"),Object.keys(s.fieldInfo).filter(p=>p.startsWith(t(f,g))).forEach(p=>{const M=p.replace(t(f,g),t(f,h)),y=v.get(M);y&&s.setFieldMeta(p,y)})},l=(c,f,h,g)=>{c.forEach(v=>{if(!v.toString().startsWith(t(f,h)))return;const p=v.toString().replace(t(f,h),t(f,g)),[M,y]=[s.getFieldMeta(v),s.getFieldMeta(p)];M&&s.setFieldMeta(p,M),y&&s.setFieldMeta(v,y)})};return{handleArrayFieldMetaShift:i}}class ze extends oe{constructor(){super({pluginId:"form-devtools",reconnectEveryMs:1e3})}}const x=new ze;function Ot(s){return{values:s.values??{},errorMap:s.errorMap??{},fieldMetaBase:s.fieldMetaBase??{},isSubmitted:s.isSubmitted??!1,isSubmitting:s.isSubmitting??!1,isValidating:s.isValidating??!1,submissionAttempts:s.submissionAttempts??0,isSubmitSuccessful:s.isSubmitSuccessful??!1,validationMetaMap:s.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class Ke{constructor(i){var r;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var d,u;const e=this.fieldMetaDerived.mount(),n=this.store.mount(),a=()=>{e(),n(),x.emit("form-unmounted",{id:this._formId})};(u=(d=this.options.listeners)==null?void 0:d.onMount)==null||u.call(d,{formApi:this});const{onMount:o}=this.options.validators||{};return x.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}),o&&this.validateSync("mount"),a},this.update=e=>{var u,l;if(!e)return;const n=this.options;this.options=e;const a=!!((l=(u=e.transform)==null?void 0:u.deps)!=null&&l.some((c,f)=>c!==this.prevTransformArray[f])),o=e.defaultValues&&!Y(e.defaultValues,n.defaultValues)&&!this.state.isTouched,d=!Y(e.defaultState,n.defaultState)&&!this.state.isTouched;!o&&!d&&!a||($(()=>{this.baseStore.setState(()=>Ot(Object.assign({},this.state,d?e.defaultState:{},o?{values:e.defaultValues}:{},a?{_force_re_eval:!this.state._force_re_eval}:{})))}),x.emit("form-api",{id:this._formId,state:this.store.state,options:this.options}))},this.reset=(e,n)=>{const{fieldMeta:a}=this.state,o=this.resetFieldMeta(a);e&&!(n!=null&&n.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var d;return Ot({...this.options.defaultState,values:e??this.options.defaultValues??((d=this.options.defaultState)==null?void 0:d.values),fieldMetaBase:o})})},this.validateAllFields=async e=>{const n=[];return $(()=>{Object.values(this.fieldInfo).forEach(o=>{if(!o.instance)return;const d=o.instance;n.push(Promise.resolve().then(()=>d.validate(e,{skipFormValidation:!0}))),o.instance.state.meta.isTouched||o.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(n)).flat()},this.validateArrayFieldsStartingFrom=async(e,n,a)=>{const o=this.getFieldValue(e),d=Array.isArray(o)?Math.max(o.length-1,0):null,u=[`${e}[${n}]`];for(let h=n+1;h<=(d??0);h++)u.push(`${e}[${h}]`);const l=Object.keys(this.fieldInfo).filter(h=>u.some(g=>h.startsWith(g))),c=[];return $(()=>{l.forEach(h=>{c.push(Promise.resolve().then(()=>this.validateField(h,a)))})}),(await Promise.all(c)).flat()},this.validateField=(e,n)=>{var o;const a=(o=this.fieldInfo[e])==null?void 0:o.instance;return a?(a.state.meta.isTouched||a.setMeta(d=>({...d,isTouched:!0})),a.validate(n)):[]},this.validateSync=e=>{const n=Pt(e,{...this.options,form:this,validationLogic:this.options.validationLogic||Z});let a=!1;const o={};return $(()=>{var l,c,f;for(const h of n){if(!h.validate)continue;const g=this.runValidator({validate:h.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:v,fieldErrors:p}=Vt(g),M=nt(h.cause);for(const y of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[y]===void 0)continue;const b=this.getFieldMeta(y);if(!b)continue;const{errorMap:F,errorSourceMap:A}=b,I=p==null?void 0:p[y],{newErrorValue:k,newSource:T}=Zt({newFormValidatorError:I,isPreviousErrorFromFormValidator:(A==null?void 0:A[M])==="form",previousErrorValue:F==null?void 0:F[M]});T==="form"&&(o[y]={...o[y],[M]:I}),(F==null?void 0:F[M])!==k&&this.setFieldMeta(y,L=>({...L,errorMap:{...L.errorMap,[M]:k},errorSourceMap:{...L.errorSourceMap,[M]:T}}))}((l=this.state.errorMap)==null?void 0:l[M])!==v&&this.baseStore.setState(y=>({...y,errorMap:{...y.errorMap,[M]:v}})),(v||p)&&(a=!0)}const d=nt("submit");(c=this.state.errorMap)!=null&&c[d]&&e!=="submit"&&!a&&this.baseStore.setState(h=>({...h,errorMap:{...h.errorMap,[d]:void 0}}));const u=nt("server");(f=this.state.errorMap)!=null&&f[u]&&e!=="server"&&!a&&this.baseStore.setState(h=>({...h,errorMap:{...h.errorMap,[u]:void 0}}))}),{hasErrored:a,fieldsErrorMap:o}},this.validateAsync=async e=>{const n=Bt(e,{...this.options,form:this,validationLogic:this.options.validationLogic||Z});this.state.isFormValidating||this.baseStore.setState(l=>({...l,isFormValidating:!0}));const a=[];let o;for(const l of n){if(!l.validate)continue;const c=nt(l.cause),f=this.state.validationMetaMap[c];f==null||f.lastAbortController.abort();const h=new AbortController;this.state.validationMetaMap[c]={lastAbortController:h},a.push(new Promise(async g=>{let v;try{v=await new Promise((b,F)=>{setTimeout(async()=>{if(h.signal.aborted)return b(void 0);try{b(await this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:h.signal},type:"validateAsync"}))}catch(A){F(A)}},l.debounceMs)})}catch(b){v=b}const{formError:p,fieldErrors:M}=Vt(v);M&&(o=o?{...o,...M}:M);const y=nt(l.cause);for(const b of Object.keys(this.state.fieldMeta)){if(this.baseStore.state.fieldMetaBase[b]===void 0)continue;const F=this.getFieldMeta(b);if(!F)continue;const{errorMap:A,errorSourceMap:I}=F,k=o==null?void 0:o[b],{newErrorValue:T,newSource:L}=Zt({newFormValidatorError:k,isPreviousErrorFromFormValidator:(I==null?void 0:I[y])==="form",previousErrorValue:A==null?void 0:A[y]});(A==null?void 0:A[y])!==T&&this.setFieldMeta(b,U=>({...U,errorMap:{...U.errorMap,[y]:T},errorSourceMap:{...U.errorSourceMap,[y]:L}}))}this.baseStore.setState(b=>({...b,errorMap:{...b.errorMap,[y]:p}})),g(o?{fieldErrors:o,errorMapKey:y}:void 0)}))}let d=[];const u={};if(a.length){d=await Promise.all(a);for(const l of d)if(l!=null&&l.fieldErrors){const{errorMapKey:c}=l;for(const[f,h]of Object.entries(l.fieldErrors)){const v={...u[f]||{},[c]:h};u[f]=v}}}return this.baseStore.setState(l=>({...l,isFormValidating:!1})),u},this.validate=e=>{const{hasErrored:n,fieldsErrorMap:a}=this.validateSync(e);return n&&!this.options.asyncAlways?a:this.validateAsync(e)},this.getFieldValue=e=>ot(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var n;return(n=this.fieldInfo)[e]||(n[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}})},this.setFieldMeta=(e,n)=>{this.baseStore.setState(a=>({...a,fieldMetaBase:{...a.fieldMetaBase,[e]:Dt(n,a.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((n,a)=>{const o=a;return n[o]=Lt,n},{}),this.setFieldValue=(e,n,a)=>{var l;const o=(a==null?void 0:a.dontUpdateMeta)??!1,d=(a==null?void 0:a.dontRunListeners)??!1,u=(a==null?void 0:a.dontValidate)??!1;$(()=>{o||this.setFieldMeta(e,c=>({...c,isTouched:!0,isDirty:!0,errorMap:{...c==null?void 0:c.errorMap,onMount:void 0}})),this.baseStore.setState(c=>({...c,values:gt(c.values,e,n)}))}),d||(l=this.getFieldInfo(e).instance)==null||l.triggerOnChangeListener(),u||this.validateField(e,"change")},this.deleteField=e=>{const a=[...Object.keys(this.fieldInfo).filter(o=>{const d=e.toString();return o!==d&&o.startsWith(d)}),e];this.baseStore.setState(o=>{const d={...o};return a.forEach(u=>{d.values=xe(d.values,u),delete this.fieldInfo[u],delete d.fieldMetaBase[u]}),d})},this.pushFieldValue=(e,n,a)=>{this.setFieldValue(e,o=>[...Array.isArray(o)?o:[],n],a)},this.insertFieldValue=async(e,n,a,o)=>{this.setFieldValue(e,u=>[...u.slice(0,n),a,...u.slice(n)],_(o,{dontValidate:!0}));const d=(o==null?void 0:o.dontValidate)??!1;d||await this.validateField(e,"change"),yt(this).handleArrayFieldMetaShift(e,n,"insert"),d||await this.validateArrayFieldsStartingFrom(e,n,"change")},this.replaceFieldValue=async(e,n,a,o)=>{this.setFieldValue(e,u=>u.map((l,c)=>c===n?a:l),_(o,{dontValidate:!0})),((o==null?void 0:o.dontValidate)??!1)||(await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,n,"change"))},this.removeFieldValue=async(e,n,a)=>{const o=this.getFieldValue(e),d=Array.isArray(o)?Math.max(o.length-1,0):null;if(this.setFieldValue(e,l=>l.filter((c,f)=>f!==n),_(a,{dontValidate:!0})),yt(this).handleArrayFieldMetaShift(e,n,"remove"),d!==null){const l=`${e}[${d}]`;this.deleteField(l)}((a==null?void 0:a.dontValidate)??!1)||(await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,n,"change"))},this.swapFieldValues=(e,n,a,o)=>{this.setFieldValue(e,u=>{const l=u[n],c=u[a];return gt(gt(u,`${n}`,c),`${a}`,l)},_(o,{dontValidate:!0})),yt(this).handleArrayFieldMetaShift(e,n,"swap",a),((o==null?void 0:o.dontValidate)??!1)||(this.validateField(e,"change"),this.validateField(`${e}[${n}]`,"change"),this.validateField(`${e}[${a}]`,"change"))},this.moveFieldValues=(e,n,a,o)=>{this.setFieldValue(e,u=>{const l=[...u];return l.splice(a,0,l.splice(n,1)[0]),l},_(o,{dontValidate:!0})),yt(this).handleArrayFieldMetaShift(e,n,"move",a),((o==null?void 0:o.dontValidate)??!1)||(this.validateField(e,"change"),this.validateField(`${e}[${n}]`,"change"),this.validateField(`${e}[${a}]`,"change"))},this.clearFieldValues=(e,n)=>{const a=this.getFieldValue(e),o=Array.isArray(a)?Math.max(a.length-1,0):null;if(this.setFieldValue(e,[],_(n,{dontValidate:!0})),o!==null)for(let u=0;u<=o;u++){const l=`${e}[${u}]`;this.deleteField(l)}((n==null?void 0:n.dontValidate)??!1)||this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(n=>({...n,fieldMetaBase:{...n.fieldMetaBase,[e]:Lt},values:this.options.defaultValues?gt(n.values,e,ot(this.options.defaultValues,e)):n.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[n,a])=>(Object.keys(a).length&&a.errors.length&&(e[n]={errors:a.errors,errorMap:a.errorMap}),e),{})}),this.parseValuesWithSchema=e=>et.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>et.validateAsync({value:this.state.values,validationSource:"form"},e),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this._formId=(i==null?void 0:i.formId)??je(),this._devtoolsSubmissionOverride=!1,this.baseStore=new Et(Ot({...i==null?void 0:i.defaultState,values:(i==null?void 0:i.defaultValues)??((r=i==null?void 0:i.defaultState)==null?void 0:r.values)})),this.fieldMetaDerived=new N({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:n,prevVal:a})=>{var f,h,g;const o=a,d=e==null?void 0:e[0],u=n[0];let l=0;const c={};for(const v of Object.keys(u.fieldMetaBase)){const p=u.fieldMetaBase[v],M=d==null?void 0:d.fieldMetaBase[v],y=o==null?void 0:o[v],b=ot(u.values,v);let F=y==null?void 0:y.errors;if(!M||p.errorMap!==M.errorMap){F=Object.values(p.errorMap??{}).filter(L=>L!==void 0);const T=(f=this.getFieldInfo(v))==null?void 0:f.instance;T&&!T.options.disableErrorFlat&&(F=F==null?void 0:F.flat(1))}const A=!Ue(F??[]),I=!p.isDirty,k=Y(b,ot(this.options.defaultValues,v))||Y(b,(g=(h=this.getFieldInfo(v))==null?void 0:h.instance)==null?void 0:g.options.defaultValue);if(y&&y.isPristine===I&&y.isValid===A&&y.isDefaultValue===k&&y.errors===F&&p===M){c[v]=y,l++;continue}c[v]={...p,errors:F,isPristine:I,isValid:A,isDefaultValue:k}}return Object.keys(u.fieldMetaBase).length&&o&&l===Object.keys(u.fieldMetaBase).length?o:c}}),this.store=new N({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:n,prevVal:a})=>{var Wt,zt,Kt,Gt;const o=a,d=e==null?void 0:e[0],u=n[0],l=n[1],c=Object.values(l).filter(Boolean),f=c.some(S=>S.isValidating),h=c.every(S=>S.isValid),g=c.some(S=>S.isTouched),v=c.some(S=>S.isBlurred),p=c.every(S=>S.isDefaultValue),M=g&&((Wt=u.errorMap)==null?void 0:Wt.onMount),y=c.some(S=>S.isDirty),b=!y,F=!!((zt=u.errorMap)!=null&&zt.onMount||c.some(S=>{var B;return(B=S==null?void 0:S.errorMap)==null?void 0:B.onMount})),A=!!f;let I=(o==null?void 0:o.errors)??[];(!d||u.errorMap!==d.errorMap)&&(I=Object.values(u.errorMap).reduce((S,B)=>B===void 0?S:B&&$t(B)?(S.push(B.form),S):(S.push(B),S),[]));const k=I.length===0,T=h&&k,L=this.options.canSubmitWhenInvalid??!1,U=u.submissionAttempts===0&&!g&&!F||!A&&!u.isSubmitting&&T||L;let Q=u.errorMap;if(M&&(I=I.filter(S=>S!==u.errorMap.onMount),Q=Object.assign(Q,{onMount:void 0})),o&&d&&o.errorMap===Q&&o.fieldMeta===this.fieldMetaDerived.state&&o.errors===I&&o.isFieldsValidating===f&&o.isFieldsValid===h&&o.isFormValid===k&&o.isValid===T&&o.canSubmit===U&&o.isTouched===g&&o.isBlurred===v&&o.isPristine===b&&o.isDefaultValue===p&&o.isDirty===y&&Y(d,u))return o;let Ct={...u,errorMap:Q,fieldMeta:this.fieldMetaDerived.state,errors:I,isFieldsValidating:f,isFieldsValid:h,isFormValid:k,isValid:T,canSubmit:U,isTouched:g,isBlurred:v,isPristine:b,isDefaultValue:p,isDirty:y};const _t=((Kt=this.options.transform)==null?void 0:Kt.deps)??[];if(_t.length!==this.prevTransformArray.length||_t.some((S,B)=>S!==this.prevTransformArray[B])){const S=Object.assign({},this,{state:Ct});(Gt=this.options.transform)==null||Gt.fn(S),Ct=S.state,this.prevTransformArray=_t}return Ct}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(i||{});const t=Oe(e=>x.emit("form-state",{id:this._formId,state:e}),{wait:300});this.store.subscribe(()=>{t(this.store.state)}),x.on("request-form-state",e=>{e.payload.id===this._formId&&x.emit("form-api",{id:this._formId,state:this.store.state,options:this.options})}),x.on("request-form-reset",e=>{e.payload.id===this._formId&&this.reset()}),x.on("request-form-force-submit",e=>{e.payload.id===this._formId&&(this._devtoolsSubmissionOverride=!0,this.handleSubmit(),this._devtoolsSubmissionOverride=!1)})}get state(){return this.store.state}get formId(){return this._formId}runValidator(i){return ue(i.validate)?et[i.type](i.value,i.validate):i.validate(i.value)}async handleSubmit(i){var e,n,a,o,d,u,l,c,f,h;this.baseStore.setState(g=>({...g,isSubmitted:!1,submissionAttempts:g.submissionAttempts+1,isSubmitSuccessful:!1})),$(()=>{Object.values(this.fieldInfo).forEach(g=>{g.instance&&(g.instance.state.meta.isTouched||g.instance.setMeta(v=>({...v,isTouched:!0})))})});const t=i??this.options.onSubmitMeta;if(!this.state.canSubmit&&!this._devtoolsSubmissionOverride){(n=(e=this.options).onSubmitInvalid)==null||n.call(e,{value:this.state.values,formApi:this,meta:t});return}this.baseStore.setState(g=>({...g,isSubmitting:!0}));const r=()=>{this.baseStore.setState(g=>({...g,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){r(),(o=(a=this.options).onSubmitInvalid)==null||o.call(a,{value:this.state.values,formApi:this,meta:t}),x.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validateAllFields",errors:Object.values(this.state.fieldMeta).map(g=>g.errors).flat()});return}if(await this.validate("submit"),!this.state.isValid){r(),(u=(d=this.options).onSubmitInvalid)==null||u.call(d,{value:this.state.values,formApi:this,meta:t}),x.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"validate",errors:this.state.errors});return}$(()=>{Object.values(this.fieldInfo).forEach(g=>{var v,p,M;(M=(p=(v=g.instance)==null?void 0:v.options.listeners)==null?void 0:p.onSubmit)==null||M.call(p,{value:g.instance.state.value,fieldApi:g.instance})})}),(c=(l=this.options.listeners)==null?void 0:l.onSubmit)==null||c.call(l,{formApi:this,meta:t});try{await((h=(f=this.options).onSubmit)==null?void 0:h.call(f,{value:this.state.values,formApi:this,meta:t})),$(()=>{this.baseStore.setState(g=>({...g,isSubmitted:!0,isSubmitSuccessful:!0})),x.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!0}),r()})}catch(g){throw this.baseStore.setState(v=>({...v,isSubmitSuccessful:!1})),x.emit("form-submission",{id:this._formId,submissionAttempt:this.state.submissionAttempts,successful:!1,stage:"inflight",onError:g}),r(),g}}setErrorMap(i){$(()=>{Object.entries(i).forEach(([t,r])=>{const e=t;if($t(r)){const{formError:n,fieldErrors:a}=Vt(r);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,u=>({...u,errorMap:{...u.errorMap,[e]:a==null?void 0:a[o]},errorSourceMap:{...u.errorSourceMap,[e]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[e]:n}}))}else this.baseStore.setState(n=>({...n,errorMap:{...n.errorMap,[e]:r}}))})})}}function Vt(s){if(s){if($t(s)){const i=Vt(s.form).formError,t=s.fields;return{formError:i,fieldErrors:t}}return{formError:s}}return{formError:void 0}}function nt(s){switch(s){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class Ge{constructor(i){this.options={},this.mount=()=>{var n,a;const t=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const r=this.getInfo();r.instance=this,this.update(this.options);const{onMount:e}=this.options.validators||{};if(e){const o=this.runValidator({validate:e,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(d=>({...d,errorMap:{...d==null?void 0:d.errorMap,onMount:o},errorSourceMap:{...d==null?void 0:d.errorSourceMap,onMount:"field"}}))}return(a=(n=this.options.listeners)==null?void 0:n.onMount)==null||a.call(n,{value:this.state.value,fieldApi:this}),t},this.update=t=>{this.options=t;const r=this.name!==t.name;if(this.name=t.name,this.state.value===void 0){const e=ot(t.form.options.defaultValues,t.name),n=t.defaultValue??e;r?this.setValue(a=>a||n,{dontUpdateMeta:!0}):n!==void 0&&this.setValue(n,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(t,r)=>{this.form.setFieldValue(this.name,t,_(r,{dontRunListeners:!0,dontValidate:!0})),r!=null&&r.dontRunListeners||this.triggerOnChangeListener(),r!=null&&r.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=t=>this.form.setFieldMeta(this.name,t),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(t,r)=>{this.form.pushFieldValue(this.name,t,_(r,{dontRunListeners:!0})),r!=null&&r.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(t,r,e)=>{this.form.insertFieldValue(this.name,t,r,_(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(t,r,e)=>{this.form.replaceFieldValue(this.name,t,r,_(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(t,r)=>{this.form.removeFieldValue(this.name,t,_(r,{dontRunListeners:!0})),r!=null&&r.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(t,r,e)=>{this.form.swapFieldValues(this.name,t,r,_(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(t,r,e)=>{this.form.moveFieldValues(this.name,t,r,_(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=t=>{this.form.clearFieldValues(this.name,_(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=t=>{const r=Object.values(this.form.fieldInfo),e=[];for(const n of r){if(!n.instance)continue;const{onChangeListenTo:a,onBlurListenTo:o}=n.instance.options.validators||{};t==="change"&&(a!=null&&a.includes(this.name))&&e.push(n.instance),t==="blur"&&(o!=null&&o.includes(this.name))&&e.push(n.instance)}return e},this.validateSync=(t,r)=>{var u;const e=Pt(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||Z}),a=this.getLinkedFields(t).reduce((l,c)=>{const f=Pt(t,{...c.options,form:c.form,validationLogic:c.form.options.validationLogic||Z});return f.forEach(h=>{h.field=c}),l.concat(f)},[]);let o=!1;$(()=>{const l=(c,f)=>{var y;const h=Mt(f.cause),g=f.validate?se(c.runValidator({validate:f.validate,value:{value:c.store.state.value,validationSource:"field",fieldApi:c},type:"validate"})):void 0,v=r[h],{newErrorValue:p,newSource:M}=te({formLevelError:v,fieldLevelError:g});((y=c.state.meta.errorMap)==null?void 0:y[h])!==p&&c.setMeta(b=>({...b,errorMap:{...b.errorMap,[h]:p},errorSourceMap:{...b.errorSourceMap,[h]:M}})),p&&(o=!0)};for(const c of e)l(this,c);for(const c of a)c.validate&&l(c.field,c)});const d=Mt("submit");return(u=this.state.meta.errorMap)!=null&&u[d]&&t!=="submit"&&!o&&this.setMeta(l=>({...l,errorMap:{...l.errorMap,[d]:void 0},errorSourceMap:{...l.errorSourceMap,[d]:void 0}})),{hasErrored:o}},this.validateAsync=async(t,r)=>{const e=Bt(t,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||Z}),n=await r,a=this.getLinkedFields(t),o=a.reduce((f,h)=>{const g=Bt(t,{...h.options,form:h.form,validationLogic:h.form.options.validationLogic||Z});return g.forEach(v=>{v.field=h}),f.concat(g)},[]);this.state.meta.isValidating||this.setMeta(f=>({...f,isValidating:!0}));for(const f of a)f.setMeta(h=>({...h,isValidating:!0}));const d=[],u=[],l=(f,h,g)=>{const v=Mt(h.cause),p=f.getInfo().validationMetaMap[v];p==null||p.lastAbortController.abort();const M=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:M},g.push(new Promise(async y=>{var T;let b;try{b=await new Promise((L,U)=>{this.timeoutIds.validations[h.cause]&&clearTimeout(this.timeoutIds.validations[h.cause]),this.timeoutIds.validations[h.cause]=setTimeout(async()=>{if(M.signal.aborted)return L(void 0);try{L(await this.runValidator({validate:h.validate,value:{value:f.store.state.value,fieldApi:f,signal:M.signal,validationSource:"field"},type:"validateAsync"}))}catch(Q){U(Q)}},h.debounceMs)})}catch(L){b=L}if(M.signal.aborted)return y(void 0);const F=se(b),A=(T=n[this.name])==null?void 0:T[v],{newErrorValue:I,newSource:k}=te({formLevelError:A,fieldLevelError:F});f.setMeta(L=>({...L,errorMap:{...L==null?void 0:L.errorMap,[v]:I},errorSourceMap:{...L.errorSourceMap,[v]:k}})),y(I)}))};for(const f of e)f.validate&&l(this,f,d);for(const f of o)f.validate&&l(f.field,f,u);let c=[];(d.length||u.length)&&(c=await Promise.all(d),await Promise.all(u)),this.setMeta(f=>({...f,isValidating:!1}));for(const f of a)f.setMeta(h=>({...h,isValidating:!1}));return c.filter(Boolean)},this.validate=(t,r)=>{var o;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:e}=r!=null&&r.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(t),{hasErrored:n}=this.validateSync(t,e[this.name]??{});if(n&&!this.options.asyncAlways)return(o=this.getInfo().validationMetaMap[Mt(t)])==null||o.lastAbortController.abort(),this.state.meta.errors;const a=r!=null&&r.skipFormValidation?Promise.resolve({}):this.form.validateAsync(t);return this.validateAsync(t,a)},this.handleChange=t=>{this.setValue(t)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(r=>({...r,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(r=>({...r,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=t=>et.validate({value:this.state.value,validationSource:"field"},t),this.parseValueWithSchemaAsync=t=>et.validateAsync({value:this.state.value,validationSource:"field"},t),this.form=i.form,this.name=i.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new N({deps:[this.form.store],fn:()=>{const t=this.form.getFieldValue(this.name),r=this.form.getFieldMeta(this.name)??{...Lt,...i.defaultMeta};return{value:t,meta:r}}}),this.options=i}get state(){return this.store.state}runValidator(i){return ue(i.validate)?et[i.type](i.value,i.validate):i.validate(i.value)}setErrorMap(i){this.setMeta(t=>({...t,errorMap:{...t.errorMap,...i}}))}triggerOnBlurListener(){var r,e,n,a,o,d;const i=(r=this.form.options.listeners)==null?void 0:r.onBlurDebounceMs;i&&i>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var u,l;(l=(u=this.form.options.listeners)==null?void 0:u.onBlur)==null||l.call(u,{formApi:this.form,fieldApi:this})},i)):(n=(e=this.form.options.listeners)==null?void 0:e.onBlur)==null||n.call(e,{formApi:this.form,fieldApi:this});const t=(a=this.options.listeners)==null?void 0:a.onBlurDebounceMs;t&&t>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var u,l;(l=(u=this.options.listeners)==null?void 0:u.onBlur)==null||l.call(u,{value:this.state.value,fieldApi:this})},t)):(d=(o=this.options.listeners)==null?void 0:o.onBlur)==null||d.call(o,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var r,e,n,a,o,d;const i=(r=this.form.options.listeners)==null?void 0:r.onChangeDebounceMs;i&&i>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var u,l;(l=(u=this.form.options.listeners)==null?void 0:u.onChange)==null||l.call(u,{formApi:this.form,fieldApi:this})},i)):(n=(e=this.form.options.listeners)==null?void 0:e.onChange)==null||n.call(e,{formApi:this.form,fieldApi:this});const t=(a=this.options.listeners)==null?void 0:a.onChangeDebounceMs;t&&t>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var u,l;(l=(u=this.options.listeners)==null?void 0:u.onChange)==null||l.call(u,{value:this.state.value,fieldApi:this})},t)):(d=(o=this.options.listeners)==null?void 0:o.onChange)==null||d.call(o,{value:this.state.value,fieldApi:this})}}function se(s){if(s)return s}function Mt(s){switch(s){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}function ce(s,i=t=>t){return me.useSyncExternalStoreWithSelector(s.subscribe,()=>s.state,()=>s.state,i,qe)}function qe(s,i){if(Object.is(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;if(s instanceof Map&&i instanceof Map){if(s.size!==i.size)return!1;for(const[r,e]of s)if(!i.has(r)||!Object.is(e,i.get(r)))return!1;return!0}if(s instanceof Set&&i instanceof Set){if(s.size!==i.size)return!1;for(const r of s)if(!i.has(r))return!1;return!0}if(s instanceof Date&&i instanceof Date)return s.getTime()===i.getTime();const t=ie(s);if(t.length!==ie(i).length)return!1;for(let r=0;r<t.length;r++)if(!Object.prototype.hasOwnProperty.call(i,t[r])||!Object.is(s[t[r]],i[t[r]]))return!1;return!0}function ie(s){return Object.keys(s).concat(Object.getOwnPropertySymbols(s))}const At=typeof window<"u"?P.useLayoutEffect:P.useEffect;function He(s){const[i]=P.useState(()=>{const r=new Ge({...s,form:s.form,name:s.name});return r.Field=de,r});return At(i.mount,[i]),At(()=>{i.update(s)}),ce(i.store,s.mode==="array"?t=>[t.meta,Object.keys(t.value??[]).length]:void 0),i}const de=({children:s,...i})=>{const t=He(i),r=P.useMemo(()=>Dt(s,t),[s,t,t.state.value,t.state.meta]);return V.jsx(V.Fragment,{children:r})};function Xe({form:s,selector:i,children:t}){const r=ce(s.store,i);return Dt(t,r)}function Je(s){const i=P.useId(),[t]=P.useState(()=>{const r=new Ke({...s,formId:i}),e=r;return e.Field=function(a){return V.jsx(de,{...a,form:r})},e.Subscribe=function(a){return V.jsx(Xe,{form:r,selector:a.selector,children:a.children})},e});return At(t.mount,[]),At(()=>{t.update(s)}),t}const Qe=s=>{var i;return((i=s==null?void 0:s.loginForm)==null?void 0:i.username)||""},Ye=s=>{var i;return((i=s==null?void 0:s.loginForm)==null?void 0:i.password)||""},Ze=s=>{var i;return((i=s==null?void 0:s.loginForm)==null?void 0:i.isLoading)||!1},ts=s=>{var i;return(i=s==null?void 0:s.loginForm)==null?void 0:i.error},Ft=ge("login/loginByUsername",async(s,i)=>{const{extra:t,dispatch:r,rejectWithValue:e}=i;try{const n=await t.api.post("/login",s);if(!n.data)throw new Error;return r(ve.setAuthData(n.data)),n.data}catch(n){return console.log(n),e("error")}}),es={isLoading:!1,username:"",password:""},he=pe({name:"login",initialState:es,reducers:{setUsername:(s,i)=>{s.username=i.payload},setPassword:(s,i)=>{s.password=i.payload}},extraReducers:s=>{s.addCase(Ft.pending,i=>{i.error=void 0,i.isLoading=!0}).addCase(Ft.fulfilled,i=>{i.isLoading=!1}).addCase(Ft.rejected,(i,t)=>{i.isLoading=!1,i.error=t.payload})}}),{actions:re}=he,{reducer:ss}=he,Rt=P.forwardRef(({className:s,orientation:i="vertical",...t},r)=>V.jsx("div",{ref:r,className:ht("space-y-2",i==="horizontal"&&"flex items-center space-x-2 space-y-0",s),...t}));Rt.displayName="Field";const Nt=P.forwardRef(({className:s,...i},t)=>V.jsx("label",{ref:t,className:ht("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",s),...i}));Nt.displayName="FieldLabel";const is=P.forwardRef(({...s},i)=>V.jsx("div",{ref:i,...s}));is.displayName="FieldControl";const rs=P.forwardRef(({className:s,...i},t)=>V.jsx("p",{ref:t,className:ht("text-sm text-muted-foreground",s),...i}));rs.displayName="FieldDescription";const Ut=P.forwardRef(({className:s,children:i,errors:t,...r},e)=>{const n=(t==null?void 0:t.join(", "))||i;return n?V.jsx("p",{ref:e,className:ht("text-sm font-medium text-destructive",s),...r,children:n}):null});Ut.displayName="FieldError";const ns=P.forwardRef(({className:s,...i},t)=>V.jsx("legend",{ref:t,className:ht("text-sm font-medium leading-none",s),...i}));ns.displayName="FieldLegend";const as={loginForm:ss},ds=({className:s,onSuccess:i})=>{const{t}=ye(),r=Me(),e=ft(Qe),n=ft(Ye),a=ft(Ze),o=ft(ts),d=be(),u=Je({defaultValues:{username:e||"",password:n||""},onSubmit:async({value:l})=>{(await r(Ft({username:l.username||"",password:l.password||""}))).meta.requestStatus==="fulfilled"&&(i(),d())}});return V.jsx(Ve,{removeAfterUnmount:!0,reducers:as,children:V.jsx("form",{onSubmit:l=>{l.preventDefault(),l.stopPropagation(),u.handleSubmit()},className:s,children:V.jsxs("div",{className:"flex flex-col space-y-6",children:[V.jsx("h2",{className:"text-lg font-semibold",children:t("Ð¤Ð¾Ñ€Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸")}),o&&V.jsx("p",{className:"text-sm font-medium text-destructive",children:t("Ð’Ñ‹ Ð²Ð²ÐµÐ»Ð¸ Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð»Ð¾Ð³Ð¸Ð½ Ð¸Ð»Ð¸ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ")}),V.jsx(u.Field,{name:"username",children:l=>{var f;const c=l.state.meta.isTouched&&!l.state.meta.isValid;return V.jsxs(Rt,{"data-invalid":c,className:"flex flex-col space-y-2",children:[V.jsx(Nt,{htmlFor:l.name,children:t("Username")}),V.jsx(Jt,{id:l.name,name:l.name,type:"text",placeholder:t("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ username"),value:l.state.value,onBlur:l.handleBlur,onChange:h=>{l.handleChange(h.target.value),r(re.setUsername(h.target.value))},"aria-invalid":c,autoFocus:!0,autoComplete:"username"}),c&&V.jsx(Ut,{errors:(f=l.state.meta.errors)==null?void 0:f.map(h=>typeof h=="string"?h:String(h)).filter(h=>!!h)})]})}}),V.jsx(u.Field,{name:"password",children:l=>{var f;const c=l.state.meta.isTouched&&!l.state.meta.isValid;return V.jsxs(Rt,{"data-invalid":c,className:"flex flex-col space-y-2",children:[V.jsx(Nt,{htmlFor:l.name,children:t("Password")}),V.jsx(Jt,{id:l.name,name:l.name,type:"password",placeholder:t("Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ"),value:l.state.value,onBlur:l.handleBlur,onChange:h=>{l.handleChange(h.target.value),r(re.setPassword(h.target.value))},"aria-invalid":c,autoComplete:"current-password"}),c&&V.jsx(Ut,{errors:(f=l.state.meta.errors)==null?void 0:f.map(h=>typeof h=="string"?h:String(h)).filter(h=>!!h)})]})}}),V.jsx(u.Subscribe,{selector:l=>[l.canSubmit,l.isSubmitting],children:([l,c])=>V.jsxs(Se,{type:"submit",disabled:!l||a||c,className:"w-full",children:[(a||c)&&V.jsx(we,{className:"mr-2 h-4 w-4 animate-spin"}),t("Ð’Ð¾Ð¹Ñ‚Ð¸")]})})]})})})};export{ds as default};
