import{r as c,u as E,j as t,V as m,H as j,S as C,c as S,a as Y,b as x,g as $,d as O,e as k,f as N,h as F,i as W,P as M}from"./index-B5sKGF0T.js";import{C as U,A as q,T as J,a as Q}from"./Avatar-CS1FaJc3.js";import{I as v}from"./Input-C1-90urI.js";import{L as _}from"./ListBox-CsHUvXk9.js";import{T as D}from"./Text-SEN0pMjy.js";import{D as X}from"./DynamicModuleLoader-CRhxfWmK.js";var R=(e=>(e.RUB="RUB",e.EUR="EUR",e.USD="USD",e))(R||{});const Z=[{value:R.RUB,content:R.RUB},{value:R.EUR,content:R.EUR},{value:R.USD,content:R.USD}],ee=c.memo(({className:e,value:r,onChange:a,readonly:n})=>{const{t:s}=E(),o=c.useCallback(i=>{a==null||a(i)},[a]),d={className:e,value:r,defaultValue:s("Укажите валюту"),label:s("Укажите валюту"),items:Z,onChange:o,readonly:n,direction:"top right"};return t.jsx(_,{...d})});var u=(e=>(e.Russia="Russia",e.Belarus="Belarus",e.Ukraine="Ukraine",e.Kazakhstan="Kazahstan",e.Armenia="Armenia",e))(u||{});const ae=[{value:u.Armenia,content:u.Armenia},{value:u.Russia,content:u.Russia},{value:u.Belarus,content:u.Belarus},{value:u.Kazakhstan,content:u.Kazakhstan},{value:u.Ukraine,content:u.Ukraine}],re=c.memo(({className:e,value:r,onChange:a,readonly:n})=>{const{t:s}=E(),o=c.useCallback(i=>{a==null||a(i)},[a]),d={className:e,value:r,defaultValue:s("Укажите страну"),label:s("Укажите страну"),items:ae,onChange:o,readonly:n,direction:"top right"};return t.jsx(_,{...d})}),te=()=>{const{t:e}=E();return t.jsx(j,{justify:"center",max:!0,children:t.jsx(D,{variant:"error",title:e("Произошла ошибка при загрузке профиля"),text:e("Попробуйте обновить страницу"),align:"center"})})},se=()=>t.jsx(U,{padding:"24",max:!0,children:t.jsxs(m,{gap:"32",children:[t.jsx(j,{max:!0,justify:"center",children:t.jsx(C,{border:"100%",width:128,height:128})}),t.jsxs(j,{gap:"32",max:!0,children:[t.jsxs(m,{gap:"16",max:!0,children:[t.jsx(C,{width:"100%",height:38}),t.jsx(C,{width:"100%",height:38}),t.jsx(C,{width:"100%",height:38}),t.jsx(C,{width:"100%",height:38})]}),t.jsxs(m,{gap:"16",max:!0,children:[t.jsx(C,{width:"100%",height:38}),t.jsx(C,{width:"100%",height:38}),t.jsx(C,{width:"100%",height:38}),t.jsx(C,{width:"100%",height:38})]})]})]})}),ne=c.memo(e=>{const{className:r,data:a,readonly:n,onChangeFirstname:s,onChangeLastname:o,onChangeAge:d,onChangeCity:i,onChangeAvatar:y,onChangeUsername:g,onChangeCountry:P,onChangeCurrency:T}=e,{t:p}=E("profile");return t.jsx(U,{padding:"24",border:"partial",max:!0,className:r,children:t.jsxs(m,{gap:"32",children:[(a==null?void 0:a.avatar)&&t.jsx(j,{justify:"center",max:!0,children:t.jsx(q,{size:128,src:a==null?void 0:a.avatar})}),t.jsxs(j,{gap:"24",max:!0,children:[t.jsxs(m,{gap:"16",max:!0,children:[t.jsx(v,{value:a==null?void 0:a.first,label:p("Имя"),onChange:s,readonly:n,"data-testid":"ProfileCard.firstname"}),t.jsx(v,{value:a==null?void 0:a.lastname,label:p("Фамилия"),onChange:o,readonly:n,"data-testid":"ProfileCard.lastname"}),t.jsx(v,{value:a==null?void 0:a.age,label:p("Возраст"),onChange:d,readonly:n}),t.jsx(v,{value:a==null?void 0:a.city,label:p("Город"),onChange:i,readonly:n})]}),t.jsxs(m,{gap:"16",max:!0,children:[t.jsx(v,{value:a==null?void 0:a.username,label:p("Имя пользователя"),onChange:g,readonly:n}),t.jsx(v,{value:a==null?void 0:a.avatar,label:p("Cсылка на аватар"),onChange:y,readonly:n}),t.jsx(ee,{value:a==null?void 0:a.currency,onChange:T,readonly:n}),t.jsx(re,{value:a==null?void 0:a.country,onChange:P,readonly:n})]})]})]})})}),oe=e=>{const{isLoading:r,error:a}=e,{t:n}=E();return r?t.jsx(se,{}):a?t.jsx(te,{}):t.jsx(ne,{...e})};var h=(e=>(e.INCORRECT_USER_DATA="INCORRECT_USER_DATA",e.INCORRECT_AGE="INCORRECT_AGE",e.INCORRECT_COUNTRY="INCORRECT_COUNTRY",e.NO_DATA="NO_DATA",e.SERVER_ERROR="SERVER_ERROR",e))(h||{});const I=e=>{var r;return(r=e.profile)==null?void 0:r.form},ie=e=>{var r;return(r=e.profile)==null?void 0:r.isLoading},le=e=>{var r;return(r=e.profile)==null?void 0:r.error},w=e=>{var r;return(r=e.profile)==null?void 0:r.readonly},ce=e=>{var r;return(r=e.profile)==null?void 0:r.validateErrors},b=S("profile/fetchProfileData",async(e,r)=>{const{extra:a,rejectWithValue:n}=r;try{const s=await a.api.get(`/profile/${e}`);if(!s.data)throw new Error;return s.data}catch(s){return console.log(s),n("error")}}),de=e=>{if(!e)return[h.NO_DATA];const{first:r,lastname:a,age:n,country:s}=e,o=[];return(!r||!a)&&o.push(h.INCORRECT_USER_DATA),(!n||!Number.isInteger(n))&&o.push(h.INCORRECT_AGE),s||o.push(h.INCORRECT_COUNTRY),o},A=S("profile/updateProfileData",async(e,r)=>{const{extra:a,rejectWithValue:n,getState:s}=r,o=I(s()),d=de(o);if(d.length)return n(d);try{const i=await a.api.put(`/profile/${o==null?void 0:o.id}`,o);if(!i.data)throw new Error;return i.data}catch(i){return console.log(i),n([h.SERVER_ERROR])}}),ue={readonly:!0,isLoading:!1,error:void 0,data:void 0},L=Y({name:"profile",initialState:ue,reducers:{setReadonly:(e,r)=>{e.readonly=r.payload},cancelEdit:e=>{e.readonly=!0,e.validateErrors=void 0,e.form=e.data},updateProfile:(e,r)=>{e.form={...e.form,...r.payload}}},extraReducers:e=>{e.addCase(b.pending,r=>{r.error=void 0,r.isLoading=!0}).addCase(b.fulfilled,(r,a)=>{r.isLoading=!1,r.data=a.payload,r.form=a.payload}).addCase(b.rejected,(r,a)=>{r.isLoading=!1,r.error=a.payload}).addCase(A.pending,r=>{r.validateErrors=void 0,r.isLoading=!0}).addCase(A.fulfilled,(r,a)=>{r.isLoading=!1,r.data=a.payload,r.form=a.payload,r.readonly=!0,r.validateErrors=void 0}).addCase(A.rejected,(r,a)=>{r.isLoading=!1,r.validateErrors=a.payload})}}),{actions:f}=L,{reducer:he}=L,fe=e=>{var r;return(r=e.profile)==null?void 0:r.data},Ce=c.memo(e=>{const{className:r}=e,{t:a}=E("profile"),n=x($),s=x(fe),o=(n==null?void 0:n.id)===(s==null?void 0:s.id),d=x(w),i=O(),y=c.useCallback(()=>{i(f.setReadonly(!1))},[i]),g=c.useCallback(()=>{i(f.cancelEdit())},[i]),P=c.useCallback(()=>{i(A())},[i]);return t.jsx(U,{padding:"24",fullWidth:!0,border:"partial",children:t.jsxs(j,{max:!0,justify:"between",className:k("",{},[r]),children:[t.jsx(D,{title:a("Профиль")}),o&&t.jsx("div",{children:d?t.jsx(N,{onClick:y,"data-testid":"EditableProfileCardHeader.EditButton",children:a("Редактировать")}):t.jsxs(j,{gap:"8",children:[t.jsx(N,{onClick:g,"data-testid":"EditableProfileCardHeader.CancelButton",color:"error",children:a("Отменить")}),t.jsx(N,{onClick:P,"data-testid":"EditableProfileCardHeader.SaveButton",color:"success",children:a("Сохранить")})]})})]})})}),ge={profile:he},pe=c.memo(e=>{const{className:r,id:a}=e,{t:n}=E("profile"),s=O(),o=x(I),d=x(ie),i=x(le),y=x(w),g=x(ce),P={[h.SERVER_ERROR]:n("Серверная ошибка при сохранении"),[h.INCORRECT_COUNTRY]:n("Некорректный регион"),[h.NO_DATA]:n("Данные не указаны"),[h.INCORRECT_USER_DATA]:n("Имя и фамилия обязательны"),[h.INCORRECT_AGE]:n("Некорректный возраст")};F(()=>{a&&s(b(a))});const T=c.useCallback(l=>{s(f.updateProfile({first:l||""}))},[s]),p=c.useCallback(l=>{s(f.updateProfile({lastname:l||""}))},[s]),B=c.useCallback(l=>{s(f.updateProfile({city:l||""}))},[s]),H=c.useCallback(l=>{s(f.updateProfile({age:Number(l||0)}))},[s]),V=c.useCallback(l=>{s(f.updateProfile({username:l||""}))},[s]),z=c.useCallback(l=>{s(f.updateProfile({avatar:l||""}))},[s]),G=c.useCallback(l=>{s(f.updateProfile({currency:l}))},[s]),K=c.useCallback(l=>{s(f.updateProfile({country:l}))},[s]);return t.jsx(X,{reducers:ge,children:t.jsxs(m,{gap:"8",max:!0,className:k("",{},[r]),children:[t.jsx(Ce,{}),(g==null?void 0:g.length)&&g.map(l=>t.jsx(J,{theme:Q.ERROR,text:P[l],"data-testid":"EditableProfileCard.Error"},l)),t.jsx(oe,{data:o,isLoading:d,error:i,readonly:y,onChangeFirstname:T,onChangeLastname:p,onChangeAge:H,onChangeCity:B,onChangeUsername:V,onChangeAvatar:z,onChangeCurrency:G,onChangeCountry:K})]})})}),ye=({className:e})=>{const{id:r}=W();return t.jsx(M,{"data-testid":"ProfilePage",className:k("",{},[e]),children:t.jsx(m,{gap:"16",max:!0,children:t.jsx(pe,{id:r})})})};export{ye as default};
